"use strict";var Constant,Is,Default,Str;(Constant||(Constant={})).OBSERVE_JS_ATTRIBUTE_NAME="data-observe-js",(e=>{function t(e){return null!=e&&""!==e.toString()}function n(e){return t(e)&&"object"==typeof e}e.defined=t,e.definedObject=n,e.definedBoolean=function(e){return t(e)&&"boolean"==typeof e},e.definedString=function(e){return t(e)&&"string"==typeof e},e.definedFunction=function(e){return t(e)&&"function"==typeof e},e.definedNumber=function(e){return t(e)&&"number"==typeof e},e.definedArray=function(e){return n(e)&&e instanceof Array},e.definedDate=function(e){return n(e)&&e instanceof Date}})(Is||(Is={})),(e=>{function t(e,t){return Is.definedArray(e)?e:t}e.getAnyString=function(e,t){return"string"==typeof e?e:t},e.getString=function(e,t){return Is.definedString(e)?e:t},e.getBoolean=function(e,t){return Is.definedBoolean(e)?e:t},e.getNumber=function(e,t){return Is.definedNumber(e)?e:t},e.getFunction=function(e,t){return Is.definedFunction(e)?e:t},e.getArray=t,e.getObject=function(e,t){return Is.definedObject(e)?e:t},e.getDate=function(e,t){return Is.definedDate(e)?e:t},e.getStringOrArray=function(e,n){let r=n;if(Is.definedString(e)){const t=e.toString().split("space");0===t.length?e=n:r=t}else r=t(e,n);return r}})(Default||(Default={})),(Str||(Str={})).newGuid=function(){const e=[];for(let t=0;t<32;t++){8!==t&&12!==t&&16!==t&&20!==t||e.push("-");const n=Math.floor(16*Math.random()).toString(16);e.push(n)}return e.join("")},(()=>{let _configuration={};const _watches={};let _watches_Cancel=!1;function collectDOMObjects(){const e=_configuration.domElementTypes,t=e.length;for(let n=0;n<t;n++){const t=document.getElementsByTagName(e[n]),r=[].slice.call(t),o=r.length;for(let e=0;e<o&&collectDOMObject(r[e]);e++);}}function collectDOMObject(e){let t=!0;if(Is.defined(e)&&e.hasAttribute(Constant.OBSERVE_JS_ATTRIBUTE_NAME)){const n=e.getAttribute(Constant.OBSERVE_JS_ATTRIBUTE_NAME);if(Is.definedString(n)){const r=getObjectFromString(n);if(r.parsed&&Is.definedObject(r.object)){const t=getWatchOptions(r.object);Is.definedString(e.id)||(e.id=Str.newGuid()),t.removeAttribute&&e.removeAttribute(Constant.OBSERVE_JS_ATTRIBUTE_NAME),createWatch(e,t,e.id)}else logError(_configuration.text.attributeNotValidErrorText.replace("{{attribute_name}}",Constant.OBSERVE_JS_ATTRIBUTE_NAME)),t=!1}else logError(_configuration.text.attributeNotSetErrorText.replace("{{attribute_name}}",Constant.OBSERVE_JS_ATTRIBUTE_NAME)),t=!1}return t}function createWatch(e,t,n=null){let r=null;if(Is.definedObject(e)){r=Str.newGuid();const o=getWatchOptions(t),i={};let a=null;if(i.options=o,i.totalChanges=0,Is.definedString(n)){const e=document.getElementById(n);Is.defined(e)&&(i.domElementId=n,i.cachedObject=e.outerHTML,i.originalObject=e.outerHTML,a=e.outerHTML)}else i.cachedObject=JSON.stringify(e),i.originalObject=e,a=e;Is.defined(i.cachedObject)&&(fireCustomTriggerEvent(i.options.events.onStart,a),i.timer=setInterval((function(){watchTimer(o,r)}),o.timeout),_watches[r]=i)}return r}function watchTimer(e,t){const n=new Date;(!Is.definedDate(e.starts)||n>=e.starts)&&(watchObjectForChanges(t),Is.definedDate(e.expires)&&n>=e.expires&&cancelWatchObject(t))}function watchObjectForChanges(e){if(_watches.hasOwnProperty(e)){const t=_watches[e],n=Is.definedString(t.domElementId);let r=null;n&&(r=document.getElementById(t.domElementId),Is.defined(r)?t.originalObject=r.outerHTML:(t.originalObject="",fireCustomTriggerEvent(t.options.events.onRemove,t.domElementId)));const o=t.cachedObject,i=t.originalObject,a=n?i:JSON.stringify(i);if(o!==a){if(t.options.reset?n?r.outerHTML=t.cachedObject:t.originalObject=getObjectFromString(o).object:t.cachedObject=a,n)fireCustomTriggerEvent(t.options.events.onChange,o,a);else{const e=getObjectFromString(o).object,n=getObjectFromString(a).object;Is.definedArray(e)||Is.definedArray(n)?fireCustomTriggerEvent(t.options.events.onChange,e,n):(compareWatchObject(e,n,t),Is.definedFunction(t.options.events.onPropertyChange)&&compareWatchObjectProperties(e,n,t))}t.totalChanges++,t.options.pauseTimeoutOnChange>0&&pauseWatchObject(e,t.options.pauseTimeoutOnChange),t.options.cancelOnChange&&cancelWatchObject(e),t.options.maximumChangesBeforeCanceling>0&&t.totalChanges>=t.options.maximumChangesBeforeCanceling&&cancelWatchObject(e)}}}function compareWatchObject(e,t,n){if(Is.definedArray(n.options.propertyNames)){const r=n.options.propertyNames.length;for(let o=0;o<r;o++){const r=n.options.propertyNames[o];if(e[r]!==t[r]){fireCustomTriggerEvent(n.options.events.onChange,e,t);break}}}else fireCustomTriggerEvent(n.options.events.onChange,e,t)}function compareWatchObjectProperties(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const o=e[r];let i=null;t.hasOwnProperty(r)&&(i=t[r]),Is.definedObject(o)&&Is.definedObject(i)?compareWatchObjectProperties(o,i,n):(!Is.definedArray(n.options.propertyNames)||n.options.propertyNames.indexOf(r)>-1)&&JSON.stringify(o)!==JSON.stringify(i)&&fireCustomTriggerEvent(n.options.events.onPropertyChange,r,o,i)}}function cancelWatchesForObjects(){for(let e in _watches)_watches.hasOwnProperty(e)&&cancelWatchObject(e)}function cancelWatchObject(e){if(_watches.hasOwnProperty(e)){const t=_watches[e].options;(t.allowCanceling||_watches_Cancel)&&(fireCustomTriggerEvent(t.events.onCancel,e),clearInterval(_watches[e].timer),delete _watches[e])}}function pauseWatchObject(e,t){let n=!1;if(_watches.hasOwnProperty(e)){const r=_watches[e].options;r.allowPausing&&(r.starts=new Date,r.starts.setMilliseconds(r.starts.getMilliseconds()+t),n=!0)}return n}function getWatchOptions(e){let t=Default.getObject(e,{});return t.timeout=Default.getNumber(t.timeout,250),t.starts=Default.getDate(t.starts,null),t.expires=Default.getDate(t.expires,null),t.reset=Default.getBoolean(t.reset,!1),t.cancelOnChange=Default.getBoolean(t.cancelOnChange,!1),t.maximumChangesBeforeCanceling=Default.getNumber(t.maximumChangesBeforeCanceling,0),t.pauseTimeoutOnChange=Default.getNumber(t.pauseTimeoutOnChange,0),t.propertyNames=Default.getArray(t.propertyNames,null),t.allowCanceling=Default.getBoolean(t.allowCanceling,!0),t.allowPausing=Default.getBoolean(t.allowPausing,!0),t.removeAttribute=Default.getBoolean(t.removeAttribute,!0),t=getWatchOptionsCustomTriggers(t),t}function getWatchOptionsCustomTriggers(e){return e.events=Default.getObject(e.events,{}),e.events.onChange=Default.getFunction(e.events.onChange,null),e.events.onPropertyChange=Default.getFunction(e.events.onPropertyChange,null),e.events.onCancel=Default.getFunction(e.events.onCancel,null),e.events.onRemove=Default.getFunction(e.events.onRemove,null),e.events.onStart=Default.getFunction(e.events.onStart,null),e}function fireCustomTriggerEvent(e,...t){Is.definedFunction(e)&&e.apply(null,[].slice.call(t,0))}function getObjectFromString(objectString){const result={parsed:!0,object:null};try{Is.definedString(objectString)&&(result.object=JSON.parse(objectString))}catch(e1){try{result.object=eval(`(${objectString})`),Is.definedFunction(result.object)&&(result.object=result.object())}catch(e){_configuration.safeMode||(logError(_configuration.text.objectErrorText.replace("{{error_1}}",e1.message).replace("{{error_2}}",e.message)),result.parsed=!1),result.object=null}}return result}function logError(e){let t=!0;return _configuration.safeMode||(console.error(e),t=!1),t}function buildDefaultConfiguration(e=null){_configuration=Default.getObject(e,{}),_configuration.safeMode=Default.getBoolean(_configuration.safeMode,!0),_configuration.domElementTypes=Default.getStringOrArray(_configuration.domElementTypes,["*"]),buildDefaultConfigurationStrings()}function buildDefaultConfigurationStrings(){_configuration.text=Default.getObject(_configuration.text,{}),_configuration.text.objectErrorText=Default.getString(_configuration.text.objectErrorText,"Errors in object: {{error_1}}, {{error_2}}"),_configuration.text.attributeNotValidErrorText=Default.getString(_configuration.text.attributeNotValidErrorText,"The attribute '{{attribute_name}}' is not a valid object."),_configuration.text.attributeNotSetErrorText=Default.getString(_configuration.text.attributeNotSetErrorText,"The attribute '{{attribute_name}}' has not been set correctly.")}const _public={watch:function(e,t){return createWatch(e,t)},cancelWatch:function(e){let t=!1;if(Is.definedString(e))if(_watches.hasOwnProperty(e))cancelWatchObject(e),t=!0;else for(let n in _watches)if(_watches.hasOwnProperty(n)&&Is.definedString(_watches[n].domElementId)&&_watches[n].domElementId===e){cancelWatchObject(n),t=!0;break}return t},cancelWatches:function(){return cancelWatchesForObjects(),_public},getWatch:function(e){let t=null;if(Is.definedString(e))if(_watches.hasOwnProperty(e))t=_watches[e];else for(let n in _watches)if(_watches.hasOwnProperty(n)&&Is.definedString(_watches[n].domElementId)&&_watches[n].domElementId===e){t=_watches[n];break}return t},getWatches:function(){return _watches},pauseWatch:function(e,t){let n=!1;if(Is.definedString(e)&&Is.definedNumber(t))if(_watches.hasOwnProperty(e))n=pauseWatchObject(e,t);else for(let r in _watches)if(_watches.hasOwnProperty(r)&&Is.definedString(_watches[r].domElementId)&&_watches[r].domElementId===e){n=pauseWatchObject(r,t);break}return n},pauseWatches:function(e){if(Is.definedNumber(e))for(let t in _watches)_watches.hasOwnProperty(t)&&pauseWatchObject(t,e);return _public},resumeWatch:function(e){let t=!1;if(Is.definedString(e))if(_watches.hasOwnProperty(e))_watches[e].options.starts=null,t=!0;else for(let n in _watches)if(_watches.hasOwnProperty(n)&&Is.definedString(_watches[n].domElementId)&&_watches[n].domElementId===e){_watches[n].options.starts=null,t=!0;break}return t},resumeWatches:function(){for(let e in _watches)_watches.hasOwnProperty(e)&&(_watches[e].options.starts=null);return _public},searchDomForNewWatches:function(){return collectDOMObjects(),_public},setConfiguration:function(e){if(Is.definedObject(e)){let t=!1;const n=_configuration;for(let r in e)e.hasOwnProperty(r)&&_configuration.hasOwnProperty(r)&&n[r]!==e[r]&&(n[r]=e[r],t=!0);t&&buildDefaultConfiguration(n)}return _public},getVersion:function(){return"1.0.1"}};buildDefaultConfiguration(),document.addEventListener("DOMContentLoaded",(function(){collectDOMObjects()})),window.addEventListener("pagehide",(function(){_watches_Cancel=!0,cancelWatchesForObjects()})),Is.defined(window.$observe)||(window.$observe=_public)})();